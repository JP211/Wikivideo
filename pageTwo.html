<!DOCTYPE html>
<html>

<head>
  <title>WIKIVIDEO</title>
  <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
  <link rel="stylesheet" type="text/css" href="assets/reset.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel='stylesheet' type='text/css' href='assets/style.css'>
</head>

<body>
  <div class='container'>
    <h2 id='articleHead'></h2>
    <hr><br>
    <div id='vidArray'></div>
    <div id='sideVids'></div>
    <br>
    <p id='articleBody'></p>

  </div> <!--container close-->

  <script>
    var config = {
      apiKey: "AIzaSyAJS4YQWU5DmESeYueG1qH1NGkjv3DncEY",
      authDomain: "fir-click-counter-7cdb9.firebaseapp.com",
      databaseURL: "https://wikivideo-90f6d.firebaseio.com/",
      storageBucket: "fir-click-counter-7cdb9.appspot.com"
      };

      firebase.initializeApp(config);

      var database = firebase.database();

      var newSearchTerm;
      $(document).ready(function () { 
      database.ref('/searchTerm').on('value', function(snapshot) {
        newSearchTerm = snapshot.val();
      function getResults(searchTerm) {
    $.getJSON("https://www.googleapis.com/youtube/v3/search",
      {
        "part": "snippet",
        "key": "AIzaSyCcaq0-kwYgkRs1yiz6gorx8i_4wydT3F0",
        "q": searchTerm,
        "maxResults": 5
      },
      function (data) {
        console.log(data);
        if (data.pageInfo.totalResults == 0) {
          alert("No results!");
        }
        // If no results, empty the list
        displayResults(data.items);
      }
    );
  }
  
  function displayResults(videos) {
    var html = "";
    var sideHtml = "";
    $.each(videos, function (index, video) {
   
      console.log(video.snippet.title);
      console.log(video.snippet.thumbnails.high.url);
      html = "<p>" + video.snippet.title + '<p><iframe width="800" height="400" src="https://www.youtube.com/embed/' + video.id.videoId + '" frameborder="0" allowfullscreen></iframe></p>';
      sideHtml = sideHtml + "<p>" +
        "<a target='_blank' href='https://www.youtube.com/watch?v=" + video.id.videoId + "'><img height='60' width='120' src='" +  video.snippet.thumbnails.high.url + "'/></a><p id='sideVidTitle'>" + video.snippet.title + '</p>';
        console.log(videos);
    });
    $("#vidArray").html(html);
    $("#sideVids").html(sideHtml);
  }
  //Use search term
      $(document).ready(function () {
        getResults(newSearchTerm);
        $('#articleHead').html(newSearchTerm);
      });
  
  });
      });

    var wikiData;
// var queryTerm = document.getElementById("queryTerm").value;

    database.ref('/searchTerm').on('value', function(snapshot) {
      newSearchTerm = snapshot.val();
        //var searchTerm = $("#searchTerm").val();
        // var url = "https://en.wikipedia.org/w/api.php?action=opensearch&search=" + searchTerm + "&format=json&callback=?";
        $.ajax({
        type: "GET",
        url: "http://en.wikipedia.org/w/api.php?&redirects=main%20page&action=parse&format=json&prop=text&section=0&page=" + newSearchTerm + "&callback=?",
        contentType: "application/json; charset=utf-8",
        async: false,
        dataType: "json",
        success: function (data) {
            console.log(data);
          var markup = data.parse.text["*"];
          var blurb = $('<div></div>').html(markup);
          $('#articleBody').html($(blurb).find('p'));
            
            // finding a tags from data
            atag = $("#articleBody").find("a");

            // for each a tag, grab the attribute href save it to a variable href. 
            // Then, select each href and replace it with the url and concatenate the href value found from above.
      atag.each(function () {
          var href = $(this).attr('href');
          $(this).attr('href', "https://en.wikipedia.org" + href);
            $(this).attr("target","_blank");
      });

      
             // console.log(changed);
             // console.log('wiki',s wikiData)
        },
        error: function (errorMessage) {
        }


    });
});

      
  </script>
</body>

</html>